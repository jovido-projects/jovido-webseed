<html xmlns:th="//www.thymeleaf.org" xmlns:field="//github.com/grundner" th:remove="tag"
      th:replace="page(body=~{::body})">
<th:block th:fragment="body" th:with="fragment=${form.fragment}">
    <div class="container" th:with="structure=${fragment.structure}">

        <!-- Title -->
        <div class="row">
            <fieldset class="col-md-12">
                <h1>
                    <span>Fragment</span>
                    <small>
                        <span>[[${fragment.structure.name}]]</span>
                        <span class="badge">[[${fragment.id} ?: _]]</span>
                    </small>
                </h1>
            </fieldset>
        </div>

        <!-- Title 2 -->
        <div class="row">
            <fieldset class="col-md-12">
                <h2>

                </h2>
            </fieldset>
        </div>

        <!-- Breadcrumb -->
        <div class="row">
            <div class="col-md-12">
                <ol class="breadcrumb">
                    <li th:each="reference : ${references}">
                        <a th:href="@{edit(id=${reference.fragmentId})}">
                            [[${reference}]]
                        </a>

                    </li>
                    <li class="active">
                        [[${fragment.name}]]
                    </li>
                </ol>
            </div>
        </div>

        <div class="row">
            <fieldset class="col-md-12">
                <div th:if="${dirty}" class="alert alert-warning" role="alert">
                    Speichern nicht vergessen!
                </div>
            </fieldset>
        </div>

        <div class="row">

            <form th:object="${form}">

                <!-- Attributes -->
                <div class="col-sm-8">
                    <h3>Attributes</h3>
                    <div class="row">
                        <div class="col-md-12">


                            <!--<input type="hidden" name="structure.name" th:value="${fragment.structure.name}">-->
                            <input type="hidden" th:field="*{fragment.structure.name}">
                            <!--<input type="text" name="referencingValue.id" th:value="${form.referencingValue?.id}">-->
                            <input type="hidden" th:field="*{fragment.id}">
                            <input type="hidden" name="languageTag" th:value="${fragment.locale?.toLanguageTag()}">

                            <div class="form-group">
                                <label class="control-label">Locale</label>
                                <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fa fa-flag"></i>
                            </span>
                                    <input type="text" class="form-control"
                                           disabled="disabled"
                                           readonly="readonly" th:value="${fragment.locale.displayName}">
                                </div>
                            </div>

                            <div class="form-group" th:classappend="${#fields.hasErrors('fragment.name')}? has-error">
                                <label th:for="name" th:text="#{fragment.name}">Field label</label>
                                <div class="input-group">
                            <span class="input-group-addon">
                                <i class="fa fa-tag"></i>
                            </span>
                                    <input id="name" class="form-control" th:field="*{fragment.name}">
                                </div>

                                <p th:if="${#fields.hasErrors('fragment.name')}" th:errors="*{fragment.name}">Incorrect date</p>
                            </div>

                            <th:block th:each="field : ${structure.fields.values()}"
                                      th:with="attribute=${fragment.getAttribute(field)}">

                                <!-- Sequence -->
                                <th:block th:if="${field.sequence}">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <strong th:text="${field.name}">Field title</strong>
                                        </div>
                                        <div class="panel-body">

                                            <th:block th:replace="fragment/field/__${field.constraint.inputType}__"
                                                      th:with="attribute?.value"/>

                                            <div class="btn-group btn-group-xs">
                                                <button formmethod="post"
                                                        th:formaction="@{edit(id=${fragment.id},addvalue=${field.name})}"
                                                        class="btn btn-sm btn-default btn-block">
                                                    <i class="glyphicon glyphicon-plus"></i>
                                                    <span>Add value</span>
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </th:block>
                                <!-- Sequence End -->


                                <!-- Field -->
                                <th:block th:unless="${field.sequence}">
                                    <div class="form-group">
                                        <label th:for="${field.name}" th:text="${field.name}">Field label</label>
                                        <th:block th:replace="fragment/field/__${field.constraint.inputType}__"
                                                  th:with="attribute?.value"/>
                                        <!--<div class="input-group input-group-sm">-->
                                        <!---->
                                        <!--</div>-->
                                    </div>
                                </th:block>
                                <!-- Field -->

                            </th:block>

                            <button formmethod="post"
                                    th:formaction="@{/fragments/save(id=${fragment.id})}"
                                    type="submit" class="btn btn-primary">
                                <i class="glyphicon glyphicon-save"></i>
                                <span>Save</span>
                            </button>

                            <input type="hidden" th:name="${_csrf.parameterName}"
                                   th:value="${_csrf.token}"/>


                        </div>
                    </div>
                </div>

                <!-- Translations -->
                <div class="col-sm-4">
                    <h3>Translations</h3>

                    <strong>Progress:</strong>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                            <span >60%</span>
                        </div>
                    </div>

                    <ul class="list-group">
                        <li class="list-group-item"
                            th:each="locale : ${locales}"
                            th:with="translation=${fragment.translationBundle.fragments.get(locale)}">

                            <span th:text="${locale}">Locale</span>
                            <th:block th:if="${translation == null}">

                                <div class="btn-group btn-group-xs pull-right">
                                    <button class="btn btn-default"
                                            th:formaction="@{/fragments/translate(id=${fragment.id},locale=${locale.toLanguageTag()})}"
                                            formmethod="post">
                                        Translate
                                    </button>
                                </div>

                            </th:block>
                            <th:block th:if="${translation != null}">
                                ok
                            </th:block>
                        </li>
                    </ul>
                </div>

            </form>

        </div>
    </div>
</th:block>
</html>