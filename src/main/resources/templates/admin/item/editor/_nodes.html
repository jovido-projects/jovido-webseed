<html xmlns:th="//www.thymeleaf.org" th:remove="tag">

<th:block th:each="hierarchy : ${@hierarchyService.allHierarchies}">

    <div class="panel panel-default">
        <div class="panel-heading">
            [[#{seed.hierarchy.__${hierarchy.name}__}]]
        </div>


        <table class="table tree" th:with="nodes = ${hierarchy.rootNodes}">
            <th:block th:fragment="tree-list(nodes)">
                <th:block th:each="node : ${nodes}" th:with="parent = ${node.parent}">
                    <tr th:class="treegrid-__${node.id}__"
                        th:classappend="${parent != null} ? treegrid-parent-__${parent?.id}__ : _">

                        <td>
                            [[${@hierarchyService.getLabelText(node)}]]
                        </td>

                        <td>
                            <div class="btn-group btn-group-xs pull-right">
                                <button class="btn btn-default"
                                        th:disabled="${node.first} ? disabled : _"
                                   th:formaction="@{move-node-up(node=${node.id})}">
                                    <i class="fa fa-arrow-up"></i>
                                </button>
                                <button class="btn btn-default"
                                        th:disabled="${node.last} ? disabled : _"
                                   th:formaction="@{move-node-down(node=${node.id})}">
                                    <i class="fa fa-arrow-down"></i>
                                </button>
                                <a class="btn btn-default"
                                   th:href="@{add-node(hierarchy=${hierarchy.id}, parent=${node.id})}">
                                    <i class="fa fa-plus"></i>
                                </a>
                                <a class="btn btn-default"
                                   th:href="@{remove-node(node=${node.id})}">
                                    <i class="fa fa-remove"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    <th:block th:if="${node.children.size() > 0}">
                        <th:block th:replace="::tree-list(${node.children})" />
                    </th:block>
                </th:block>
            </th:block>
        </table>




        <ul class="list-group">
            <!--<li class="list-group-item" th:each="node : *{item.leaf.nodes}">-->
                <!--[[${@hierarchyService.getPath(node)}]]-->

                <!--<div class="btn-group btn-group-xs pull-right">-->
                    <!--<a class="btn btn-default"-->
                       <!--th:href="@{move-node-up(node=${node.id})}">-->
                        <!--<i class="fa fa-arrow-up"></i>-->
                    <!--</a>-->
                    <!--<a class="btn btn-default"-->
                       <!--th:href="@{move-node-down(node=${node.id})}">-->
                        <!--<i class="fa fa-arrow-down"></i>-->
                    <!--</a>-->
                    <!--<a class="btn btn-default"-->
                       <!--th:href="@{remove-node(node=${node.id})}">-->
                        <!--<i class="fa fa-remove"></i>-->
                    <!--</a>-->
                <!--</div>-->
            <!--</li>-->


            <!--<th:block th:with="nodes = ${@hierarchyService.getRoots(hierarchy)}, indent = 0">-->
                <!--<th:block th:fragment="tree-list(nodes,indent)">-->
                    <!--<th:block th:each="node : ${nodes}">-->
                        <!--<li class="list-group-item">-->
                            <!--<th:block th:if="${indent > 0}">-->
                                <!--<th:block th:each="i : ${#numbers.sequence(1, indent)}">-->
                                    <!--&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-->
                                <!--</th:block>-->
                            <!--</th:block>-->
                            <!--[[${@hierarchyService.getLabelText(node)}]]-->

                            <!--<div class="btn-group btn-group-xs pull-right">-->
                                <!--<a class="btn btn-default"-->
                                   <!--th:href="@{move-node-up(node=${node.id})}">-->
                                    <!--<i class="fa fa-arrow-up"></i>-->
                                <!--</a>-->
                                <!--<a class="btn btn-default"-->
                                   <!--th:href="@{move-node-down(node=${node.id})}">-->
                                    <!--<i class="fa fa-arrow-down"></i>-->
                                <!--</a>-->
                                <!--<a class="btn btn-default"-->
                                   <!--th:href="@{remove-node(node=${node.id})}">-->
                                    <!--<i class="fa fa-remove"></i>-->
                                <!--</a>-->
                            <!--</div>-->
                        <!--</li>-->
                        <!--<th:block th:if="${node.children.size() > 0}">-->
                            <!--<th:block th:replace="::tree-list(${node.children}, ${indent+1})" />-->
                        <!--</th:block>-->
                    <!--</th:block>-->
                <!--</th:block>-->
            <!--</th:block>-->



            <li class="list-group-item">

                <div class="btn-group dropup">
                    <a type="button" class="btn btn-default" th:href="@{add-node(hierarchy=${hierarchy.id}, parent=null)}">
                        <span>Add node</span>
                    </a>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">
                            Choose a parent...
                        </li>
                        <th:block th:with="nodes = ${hierarchy.rootNodes}">
                            <th:block th:fragment="tree(nodes)">
                                <th:block th:each="node : ${nodes}">
                                    <li>
                                        <a th:href="@{add-node(
                                        hierarchy=${hierarchy.id},
                                        parent=${node?.id})}">
                                            [[${@hierarchyService.getPath(node)}]]
                                        </a>
                                    </li>
                                    <th:block th:if="${node.children.size() > 0}">
                                        <th:block th:replace="::tree(${node.children})" />
                                    </th:block>
                                </th:block>
                            </th:block>
                        </th:block>
                    </ul>
                </div>

            </li>
        </ul>
    </div>

</th:block>

</html>