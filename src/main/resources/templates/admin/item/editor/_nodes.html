<html xmlns:th="//www.thymeleaf.org" th:remove="tag">

<th:block th:each="hierarchy : ${@hierarchyService.allHierarchies}">

    <div class="panel panel-default">
        <div class="panel-heading">
            [[#{seed.hierarchy.__${hierarchy.name}__}]]
        </div>


        <table class="table tree" th:with="nodes = ${hierarchy.rootNodes}">
            <th:block th:fragment="tree-list(nodes)">
                <th:block th:each="node : ${nodes}" th:with="parent = ${node.parent}">
                    <tr th:class="treegrid-__${node.id}__"
                        th:classappend="${parent != null} ? treegrid-parent-__${parent?.id}__ : _">

                        <td>
                            [[${@hierarchyService.getLabelText(node)}]]
                            <span class="label label-default" th:text="${node.ordinal}">#</span>
                        </td>

                        <td>
                            <div class="btn-group btn-group-xs pull-right">
                                <button class="btn btn-default"
                                        th:disabled="${node.first} ? disabled : _"
                                   th:formaction="@{move-node-up(node=${node.id})}">
                                    <i class="fa fa-arrow-up"></i>
                                </button>
                                <button class="btn btn-default"
                                        th:disabled="${node.last} ? disabled : _"
                                   th:formaction="@{move-node-down(node=${node.id})}">
                                    <i class="fa fa-arrow-down"></i>
                                </button>
                                <button class="btn btn-default"
                                   th:formaction="@{add-node(hierarchy=${hierarchy.id}, parent=${node.id})}">
                                    <i class="fa fa-plus"></i>
                                </button>
                                <button class="btn btn-default"
                                   th:formaction="@{remove-node(node=${node.id})}">
                                    <i class="fa fa-remove"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <th:block th:if="${node.children.size() > 0}">
                        <th:block th:replace="::tree-list(${node.children})" />
                    </th:block>
                </th:block>
            </th:block>
        </table>




        <ul class="list-group">


            <li class="list-group-item">

                <div class="btn-group dropup">
                    <a href="#" class="btn btn-default" th:data-formaction="@{add-node(hierarchy=${hierarchy.id}, parent=null)}">
                        <span>Add node</span>
                    </a>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">
                            Choose a parent...
                        </li>
                        <th:block th:with="nodes = ${hierarchy.rootNodes}">
                            <th:block th:fragment="tree(nodes)">
                                <th:block th:each="node : ${nodes}">
                                    <li>
                                        <a th:href="@{add-node(
                                        hierarchy=${hierarchy.id},
                                        parent=${node?.id})}">
                                            [[${@hierarchyService.getPath(node)}]]
                                        </a>
                                    </li>
                                    <th:block th:if="${node.children.size() > 0}">
                                        <th:block th:replace="::tree(${node.children})" />
                                    </th:block>
                                </th:block>
                            </th:block>
                        </th:block>
                    </ul>
                </div>

            </li>
        </ul>
    </div>

</th:block>

</html>