<html xmlns:th="//www.thymeleaf.org"
      th:replace="/admin(
      main=~{::default},
      breadcrumbs=~{::breadcrumbs})"
      th:remove="tag">

<th:block th:fragment="breadcrumbs">

    <th:block th:fragment="dependent(payload)">
        <th:block th:if="${payload}">
            <th:block th:replace="::dependent(${payload.field.fragment.dependingPayload})" />
            <li>
                <span th:text="${payload?.field?.name}">Field Name</span>
                [<span th:text="${payload?.ordinal}">#</span>]
            </li>
        </th:block>
    </th:block>

    <li>
        <span th:text="${item}">Item name</span>
    </li>
    <th:block th:if="${fragment?.dependent}">
        <th:block th:replace="::dependent(${fragment?.dependingPayload})" />
    </th:block>


</th:block>

<div th:fragment="default">

    <ul th:if="${#fields.hasErrors('itemEditor')}">
        <li th:each="err : ${#fields.errors('itemEditor')}" th:text="${err}">Input is incorrect</li>
    </ul>

    <div class="row">

        <!-- Content -->
        <div class="col-md-7" th:with="fragment=${editor.fragment}">

            <h2>
                <span th:text="#{seed.structure.__${editor.fragment.structure.name}__}">Title</span>
            </h2>

            <!-- Fields -->
            <th:block th:each="attribute : ${fragment?.structure?.attributes}"
                      th:with="field=${fragment?.getField(attribute.fieldName)}">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <span th:text="${field.name}">Field Name</span>
                        <span class="badge"
                              th:if="${attribute.capacity > 1}"
                              th:text="${field.payloads.size()}">#</span>


                        <div class="btn-group btn-group-xs pull-right" th:if="${attribute.class.simpleName} eq 'FragmentAttribute'">
                            <button class="btn btn-default" disabled>
                                <i class="fa fa-search"></i>
                                <span>Suchen</span>
                            </button>
                            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
                                <i class="fa fa-plus"></i>
                                <span>Neu</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li th:each="structureName : ${attribute.structureNames}">
                                    <a th:href="@{append-payload(
                                               field=${field.name},
                                               structure=${structureName})}">
                                        <span th:text="#{seed.structure.__${structureName}__}">Structure Name</span>
                                    </a>
                                </li>
                            </ul>
                        </div>


                    </div>

                    <!-- Payloads -->
                    <ul class="list-group">
                        <th:block th:each="payload,payloadItr : ${field.payloads}">

                            <th:block th:with="bindingPath=itemEditor.fragment.fields[__${field.name}__].payloads[__${payloadItr.index}__].value">
                                <!-- Payload field -->
                                <li class="list-group-item">

                                    <th:block th:switch="${attribute.class.simpleName}">

                                        <!-- TextAttribute -->
                                        <th:block th:case="'TextAttribute'">

                                            <th:block th:unless="${attribute.multiline}">
                                                <div class="form-group">
                                                    <input type="text" th:field="*{__${bindingPath}__}" class="form-control">
                                                </div>
                                            </th:block>

                                            <th:block th:if="${attribute.multiline}">
                                                <div class="form-group">
                                    <textarea type="text" class="form-control summernote" th:rows="${attribute.rows}"
                                              th:field="*{__${bindingPath}__}"></textarea>
                                                    <script type="text/javascript">
                                        $(document).ready(function() {
                                            var name = '[[__${bindingPath}__]]]';
                                            var textarea = $('textarea[name=\'' + name + '\']');
                                            //textarea.minHeight(400);
                                            textarea.summernote({height: 900});
                                            textarea.css('min-height', '900px');
                                            textarea.css('height', '900px');
                                        });
                                    </script>
                                                </div>

                                            </th:block>



                                        </th:block>

                                        <!-- FragmentAttribute -->
                                        <th:block th:case="'FragmentAttribute'">
                                            <th:block th:if="${attribute.embeddable}">
                                                <h3>
                                                    <span th:text="${payload.ordinal + 1}">#</span>.
                                                    <span th:with="fragment=${payload.value}"
                                                          th:text="#{seed.structure.__${fragment?.structure?.name}__}">Structure Name</span>
                                                    <div class="btn-group btn-group-xs pull-right">
                                                        <button class="btn btn-default" formmethod="post"
                                                                th:formaction="@{edit(field=${field.name},index=${payloadItr.index})}">
                                                            <i class="fa fa-edit"></i>
                                                            Bearbeiten
                                                        </button>
                                                        <button class="btn btn-default ">
                                                            <i class="fa fa-arrow-up"></i>
                                                        </button>
                                                        <button class="btn btn-default ">
                                                            <i class="fa fa-arrow-down"></i>
                                                        </button>
                                                        <button class="btn btn-default ">
                                                            <i class="fa fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </h3>

                                                <span>Zusammenfassung</span>
                                            </th:block>
                                            <th:block th:unless="${attribute.embeddable}">
                                                ;(
                                            </th:block>
                                        </th:block>
                                    </th:block>
                                </li>
                            </th:block>

                        </th:block>
                    </ul>



                </div>


            </th:block>


            <!-- Editor actions (save, delete, ...) -->
            <div class="btn-group">
                <button class="btn btn-primary"
                        th:formaction="@{save}">
                    <i class="fa fa-floppy-o"></i>
                    Save
                </button>
                <!--<a class="btn btn-success"-->
                   <!--th:href="@{validate}">-->
                    <!--<i class="fa fa-check"></i>-->
                    <!--Check-->
                <!--</a>-->
                <button class="btn btn-danger" th:if="${!fragment.dependent}"
                        disabled="disabled"
                        th:formaction="@{delete}" >
                    <i class="fa fa-trash"></i>
                    Delete
                </button>
                <a class="btn btn-default" th:if="${fragment.dependent}"
                   th:href="@{close}">
                    <i class="fa fa-times"></i>
                    Close
                </a>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-md-5">

            <h2>
                <span>&nbsp;</span>
            </h2>

            <table class="table table-condensed">
                <tbody>
                <tr>
                    <th>ID</th>
                    <td>
                        <span th:text="${editor.item.id}">ID</span>
                    </td>
                </tr>
                <tr>
                    <th>Locale</th>
                    <td>
                        <span th:text="${editor.item.locale?.displayName}">Locale</span>
                    </td>
                </tr>
                <tr>
                    <th>Fragment</th>
                    <td>
                        <span th:text="${editor?.fragment}">Locale</span>
                    </td>
                </tr>
                <tr>
                    <th>Dependent</th>
                    <td>
                        <span th:text="${editor?.fragment?.dependent}">Locale</span>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>
</html>